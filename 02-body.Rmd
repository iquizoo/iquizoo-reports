# 报告正文

```{r get-body-content, results='asis'}
body_child_file <- file.path(
  getOption("reports.archytype"),
  with(
    params,
    switch(
      report_unit,
      default = str_glue("body.{customer_id}.Rmd"),
      str_glue("body.{customer_id}.{report_unit}.Rmd")
    )
  )
)
score_levels <- config::get("score.level")
report_abilities <- config::get("report.ability") %>%
  as_tibble()
n_abilities <- nrow(report_abilities)
text_to_render <- character(length = n_abilities)
for (i_row in 1:n_abilities) {
  ab_code <- report_abilities[[i_row, "code"]]
  ab_name <- report_abilities[[i_row, "name"]]
  ab_hlevel <- report_abilities[[i_row, "hlevel"]]
  ab_hstyle <- report_abilities[[i_row, "hstyle"]]
  ab_def <- report_abilities[[i_row, "def"]]
  # the scores are all missing
  if (all(is.na(dataset_unit[[ab_code]]))) {
    next
  }
  # the scores are abnormal for many duplications
  if (length(unique(dataset_unit[[ab_code]])) < 5) {
    next
  }
  text_to_render[i_row] <- knitr::knit_expand(
    text = readLines(body_child_file, encoding = "UTF-8")
  )
}
cat(knitr::knit(text = text_to_render, quiet = TRUE))
```

[^grading]: 按照学生总体表现划分A、B、C、D四个水平：其中，**水平A**为优秀，代表总体水平的90%及以上；**水平B**为良好，代表总体水平的70%至90%；**水平C**为中等，代表总体水平的30%至70%；**水平D**为较差，代表总体水平的0%至30%。下同。
