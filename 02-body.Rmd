# 报告正文

```{r setup-body-content}
body_child_file <- file.path(
  getOption("reports.archytype"),
  with(
    params,
    switch(
      report_unit,
      default = str_glue("body.{customer_id}.Rmd"),
      str_glue("body.{customer_id}.{report_unit}.Rmd")
    )
  )
)
if (!file.exists(body_child_file)) {
  body_child_file <- file.path(
    getOption("reports.archytype"),
    "body.default.Rmd"
  )
}
score_levels <- config::get("score.level")
```

```{r get-blai-content, results='asis'}
ab_code <- "blai"
ab_name <- "大脑学习能力"
ab_hlevel <- 2
ab_hstyle <- "标题2-编号"
ab_def <- "大脑学习能力反映了注意力、记忆力、自控力、反应力和思维力这五个方面的综合水平，分数越高代表大脑学习能力的综合发展水平越高。"
text_to_render_blai <- knitr::knit_expand(
  text = readLines(body_child_file, encoding = "UTF-8")
)
cat(knitr::knit(text = text_to_render_blai, quiet = TRUE))
```

::: {custom-style="标题2-编号-换页"}
## 各能力单独报告
:::

```{r get-body-content, results='asis'}
report_abilities <- config::get("report.ability") %>%
  as_tibble()
n_abilities <- nrow(report_abilities)
text_to_render <- character(length = n_abilities)
for (i_row in 1:n_abilities) {
  ab_code <- report_abilities[[i_row, "code"]]
  ab_name <- report_abilities[[i_row, "name"]]
  ab_hlevel <- report_abilities[[i_row, "hlevel"]]
  ab_hstyle <- report_abilities[[i_row, "hstyle"]]
  ab_def <- report_abilities[[i_row, "def"]]
  if (all(is.na(dataset[[ab_code]]))) {
    text_to_render[i_row] <- knitr::knit_expand(
      text = readLines(
        file.path(
          getOption("reports.archytype"),
          "body.null.Rmd"
        ), encoding = "UTF-8")
    )
    next
  }
  text_to_render[i_row] <- knitr::knit_expand(
    text = readLines(body_child_file, encoding = "UTF-8")
  )
}
cat(knitr::knit(text = text_to_render, quiet = TRUE))
```
